---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
In this section of the analysis we check whether the input data file `activity.csv` is in the *R Working Directory*, and download the zip version if necessary. Then we unzip the downloaded file. Before the download, we determine whether the code is running on a Windows-based operating system and specify the correct method (curl or wininet). 
```{r}

if(!file.exists("activity.csv")){
     dlMethod <- "curl"
     if(substr(Sys.getenv("OS"),1,7) == "Windows") dlMethod <- "wininet"
     url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
     download.file(url,destfile='activity.zip',method=dlMethod,mode="wb")
     unzip(zipfile = "activity.zip")    
}

```
For reading the file, we prefer Hadley Wickham's `readr` package, which runs orders of magnitude faster than read routines in Base R. The data is comma separated, so we'll use `read_csv` to load the activity data.  

```{r}
library(readr)
activityData <- read_csv("activity.csv",
     col_types=list(col_double(),col_character(),col_double()))

```
The unit of analysis or "observation" in the input file is a the number of steps taken in a five minute interval. Therefore, each day includes 288 individual observations. To analyze the data by day, we'll need to aggregate the number of steps by day. The `aggregate()` function ignores missing values by default, so the output data frame will have no missing values for the `steps` column. 

```{r}
dailySteps <- aggregate(steps ~ date,FUN=sum,data=activityData)
```
Since some of our analysis will be easier to read if we understand the hour of the day, we will convert the five minute intervals into a time vector. 
```{r}
activityData <- within(activityData,{
     hour <- trunc(interval / 60)
     minute <- interval - (hour * 60)
     theTime <- as.POSIXlt(sprintf("%02d:%02d:00",hour,minute),tz="","%H:%M:%S")
})
```


## What is mean total number of steps taken per day?

One way to look at the distribution of steps data is to generate a histogram. We will adjust the default of 5 break points to 8 so we can obtain a more detailed picture of the variability between 10,000 and 15,000 steps per day than is generated by the default histogram. 

```{r}
hist(dailySteps$steps,
     main="Histogram of Daily Steps",
     xlab="Total Daily Steps",
     breaks = 8)
```

The mean number of steps per day is 10,770 and the median number of steps per day is 10,670 as per the following `summary()` output.  Since we'll need to compare this summary to a version with mean substituted missing values later in the analysis, we'll also calculate skewness and kurtosis. For these statistics, we'll need the `moments` package. 

A skewness value of -0.31 means that the distribution of daily steps is slightly negatively skewed (i.e. asymetrical towards the low end of the distribution). A kurtosis value of 3.73 indicates the data is leptokurtic (i.e. it has a higher peak than a normal distribution, which would have a kurtosis of 3.0). 
```{r}
summary(dailySteps$steps)
library(moments)
skewness(dailySteps$steps)
kurtosis(dailySteps$steps)
```

## What is the average daily activity pattern?
The daily activity pattern illustrates the number of steps per five minute period, aggregated across all days. First, we'll aggregate the steps data to the average steps per five minute period, across all days. Then we'll display the result in an X / Y plot. 

```{r}
dailyPattern <- aggregate(steps ~ interval,FUN=mean,data = activityData)
plot(dailyPattern$interval,dailyPattern$steps,
     type="l",
     main="Average Steps per 5 Minute Interval",
     xlab="Interval (5 minutes)",
     ylab="Mean(steps)")
```

The five minute interval with the maximum number of steps on average is interval 835, with an average of slightly more than 206 steps over all of the days in the activity data set.

```{r}
dailyPattern[dailyPattern$steps == max(dailyPattern$steps),] 
```

## Imputing missing values

The total number of missing values in the data set is 2,304. 

```{r}
sum(is.na(activityData$steps))
```

Multiple approaches may be taken to substitute missing values with a valid value, ranging from the daily mean steps, or the interval mean steps. Since there are 288 observations in the dailyPattern data frame, we know we have valid observations for each interval in the day. Also, since the number of steps on average does vary by interval, the average per interval is probably a more appropriate missing value substitution strategy than taking the average for each day. 

We will merge the the `dailyPattern` data frame with the `activityData` frame by interval, after renaming the `steps` column in `dailySteps` to `avgSteps`. 

```{r}
theNames <- colnames(dailyPattern)
theNames[2] <- "avgSteps"
colnames(dailyPattern) <- theNames 
mergedActivity <- merge(activityData,dailyPattern,by="interval",all.x=TRUE)
mergedActivity$theNAs <- is.na(mergedActivity$steps)
mergedActivity$steps[mergedActivity$theNAs] <- mergedActivity$avgSteps[mergedActivity$theNAs]
```

Confirm the number of observations where we substituted the averge steps per interval is 2,304 with the following function. Note that there are 19 intervals where the average steps was 0, so we couldn't simply count the number of rows where `steps == avgSteps`. 

```{r}
nrow(mergedActivity[mergedActivity$steps == mergedActivity$avgSteps &
          mergedActivity$theNAs == TRUE,])
```

Now re-aggregate the data and generate a histogram and mean / median on the data frame with mean substituted missing values. 

```{r}
dailySteps <- aggregate(steps ~ date,FUN=sum,data=mergedActivity)

hist(dailySteps$steps,
     main="Histogram of Daily Steps (mean substituted NAs)",
     xlab="Total Daily Steps",
     breaks = 8)
```

The mean daily steps is now 10,770 (no change from original) and the median daily steps is now also 10,770, which is 10 steps higher than the original analysis where we excluded observations that had missing values for the number of steps. 

The skewness of the mean-substituted data is -0.33, indicating that the mean substitution did not substantively change the skewness of the data. However, the kurtosis value of the mean substituted data is 4.29, indicating that the new distribution has an even higher peak than the original data. Mean substitution had the effect of concentrating the data towards the center of the distribution, which makes sense substantively because adding new observations with means would tend to move the overall distribution towards its central tendency. 

```{r}
summary(dailySteps$steps)
skewness(dailySteps$steps)
kurtosis(dailySteps$steps)
```


## Are there differences in activity patterns between weekdays and weekends?
